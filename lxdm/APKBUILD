# Contributor: Aleksey Bobylev <al.bobylev@gmail.com>
# Maintainer: Aleksey Bobylev <al.bobylev@gmail.com>
pkgname="lxdm"
pkgver="0.5.3"
pkgrel=0
pkgdesc="GUI login manager for LXDE"
url="https://wiki.lxde.org/en/LXDM"
arch="all"
license="GPL3"
makedepends="intltool libx11-dev gtk+2.0-dev   iso-codes" # + consolekit2-dev
install="$pkgname.pre-install"
pkgusers="lxdm"
pkggroups="lxdm"
subpackages="$pkgname-lang"
source="https://downloads.sourceforge.net/lxde/$pkgname-$pkgver.tar.xz
	set-path.patch
	git-fixes.patch
	execinfo.patch
	fix-msghdr-usage.patch
	default-config.patch
	lxdm.initd
	Xsession
	PostLogout"
options="!check"

build() {
	./configure \
		--prefix=/usr \
		--libexecdir=/usr/lib/lxdm \
		--disable-consolekit \
		--enable-password \
		--without-pam \
		--with-xconn=xcb
	make
}

package() {
	make DESTDIR="$pkgdir" install

	# lxdm daemon
	install -Dm755 "$srcdir/lxdm.initd" "$pkgdir/etc/init.d/lxdm"

	# TODO: re-adapt Xsession script using dbus
	mv    "$pkgdir/etc/lxdm/Xsession"   "$pkgdir/etc/lxdm/Xsession.orig"
	install -Dm755 "$srcdir/Xsession"   "$pkgdir/etc/lxdm/Xsession"
	install -Dm755 "$srcdir/PostLogout" "$pkgdir/etc/lxdm/PostLogout"
}

sha512sums="0e3539c595a71cb850c1756dd075b8d477a4e111a4167714057cac06650e9587f338f797f14122e7b2a2f4ad35b38cd7172b83e996758abeeaf0146d65bbc26f  lxdm-0.5.3.tar.xz
e70ed2cbfdc468583fb73fa887dfc568560174bf90e7ab3ca425295a178aceafc7ac1f9cf0bf1301033a298b5be779e5a49eef4e5f44bde93e34660c7d0914ef  set-path.patch
3ac6601dafe36cfe95a7895b3e138d184b2098a58b2e93fbb168e91cd51ffef5cbc55403138b326f68b85f8d4bb3c303dc734378dca808432edf5cf85e93afd5  git-fixes.patch
b66d47a3c026f84c76fb6ae0701ff69d2736a2c0fdf898191836c0c5e2b0d624c7a7846cd38596ee800fab53ebcd843c26779c56c0f655df1659ecc5b251b576  execinfo.patch
1eaf438e64901168a557d3e278de4dd7eb4e580594175a26f9c8d27bd8de2dae81467ebd3a96f0a4dfb5f19c2257ce1ee5608e753e8d9d53c2e4ba488f798b0e  fix-msghdr-usage.patch
f745468a838760ad17d9223ac997e75c1a749d1a3aa42cfac9b50aa9a19512eb4fb79419f72a06195ce31b56142542e21c190a1a450addf14610577b0fb762bd  default-config.patch
099a93ebb8c8e48e903d5fba2a8043339f186788169a5a1ca86f75deab082c6229bdbad0386857bc0a67f782f06ae8d386710291fc5f8fc340e61b1bd8b5c31a  lxdm.initd
fd55237e89e7868c764382085caf33d71e12a8a8e34698d3bf5d84960cc3a620f7d5f97054a9db5898c44b088d1274130265670758ee05872f26941db791c103  Xsession
48f10e445c4dd1bcd798fc52d158082de4b1e31294df2567410ab6c8c1f66266a09ea5c9f5fdddee3c7c01973289e0955ce35bbec36c2b9aa2d755f81b19f957  PostLogout"
