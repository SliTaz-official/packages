# Contributor: Aleksey Bobylev <al.bobylev@gmail.com>
# Maintainer: Aleksey Bobylev <al.bobylev@gmail.com>
pkgname="lxsession"
pkgver="0.5.3"
pkgrel=0
pkgdesc="Standard session manager used by LXDE"
url="https://wiki.lxde.org/en/LXSession"
arch="all"
license="GPL2"
#depends="dbus-glib lsb-release" # ?
makedepends="intltool libx11-dev polkit-dev vala libxslt docbook-xsl automake
	gtk+2.0-dev"
subpackages="$pkgname-doc $pkgname-lang"
source="https://downloads.sourceforge.net/lxde/$pkgname-$pkgver.tar.xz
	0001-Use-GApplication-for-unique-app-handling.patch"
options="!check"

prepare() {
	default_prepare
	# https://git.archlinux.org/svntogit/community.git/tree/trunk/PKGBUILD?h=packages/lxsession
	# Regenerate C sources from Vala code
	rm *.stamp
	autoreconf -fi
}

build() {
	./configure \
		--prefix=/usr
	make
}

package() {
	make DESTDIR="$pkgdir" install

	# customize desktop.conf for SliTaz
	confdir="$pkgdir/etc/xdg/lxsession/LXDE"
	mkdir -p "$confdir"
	cp "$builddir/data/desktop.conf.example" "$confdir/desktop.conf"
	sed -i '
		s|^\(terminal_manager/command\).*|\1=terminal|;
		s|^\(launcher_manager/command\).*|\1=lxpanelctl|;
		s|^\(window_manager\).*|\1=openbox|;
		s|^#*\(iXft/Hinting\)|\1=1|;
		s|^\(sNet/ThemeName\).*|\1=Paper|;
		s|^\(sNet/IconThemeName\).*|\1=SliTaz-Paper|;
		s|^\(sGtk/FontName\).*|\1=DejaVu Sans 10|;
		s|^#*\(iGtk/ToolbarIconSize\).*|\1=2|;
		s|^#*\(sGtk/CursorThemeName\).*|\1=slitaz-polar|;
		' "$confdir/desktop.conf"

	# change icon
	sed -i 's|^Icon=.*$|Icon=session-properties|' \
		"$pkgdir/usr/share/applications/lxsession-edit.desktop"

	# config files examples
	cp data/*.example "$confdir"

	# LXDE autostart file
	touch "$confdir/autostart"
}

sha512sums="30102e9309c316a35d815747d25e0ef70f104fa785bdcc1b31611415434b173a1883434bb5480e3d6a3af106765d394c909dc139a9a21d55f25c14ae04b91c34  lxsession-0.5.3.tar.xz
616649a37c7778c0183698e5bf56ac3b14f4627209a603f35677af4071a4d592dd4ecb2d58386ddb7944678b115caaca748e14397986414b8e25c889bbdb0cdf  0001-Use-GApplication-for-unique-app-handling.patch"
