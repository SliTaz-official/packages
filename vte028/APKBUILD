# Contributor: Aleksey Bobylev <al.bobylev@gmail.com>
# Maintainer: Aleksey Bobylev <al.bobylev@gmail.com>

# last gtk2-based series is 0.28; last version is 0.28.2 (2011-08-28)
pkgname="vte028"
pkgver="0.28.2"
pkgrel=0
pkgdesc="Terminal capabilities for GTK+ widgets"
url="https://www.gnome.org/"
arch="all"
license="GPL2"
makedepends="ncurses-dev intltool gtk+2.0-dev gobject-introspection-dev"
subpackages="$pkgname-terminal $pkgname-dev $pkgname-doc $pkgname-lang"
source="http://ftp.gnome.org/pub/GNOME/sources/vte/0.28/vte-$pkgver.tar.xz
	lang.patch
	AltKey.patch"
builddir="$srcdir/vte-$pkgver"
options="!check"

prepare() {
	default_prepare

	sed -i 's|-Werror-implicit-function-declaration|-Wimplicit-function-declaration|' \
		./configure
}

build() {
	./configure \
		--prefix=/usr \
		--disable-static \
		--enable-introspection \
		--disable-python \
		--disable-gnome-pty-helper
	sed -i 's| -shared | -Wl,-Os,--as-needed\0|g' libtool
	make -j1
}

package() {
	make DESTDIR="$pkgdir" install

	# add 'Home' and 'End' keys
	#sed -i '9i\ \ \ \ :kh=\\E[H:@7=\\E[F:\\' $install/usr/share/vte/termcap-0.0/xterm
}

terminal() {
	mkdir -p "$subpkgdir/usr"
	mv "$pkgdir/usr/bin" "$subpkgdir/usr"
	pkgdesc="X terminal based on vte"
}

sha512sums="d6a50481aaa8946cca3779e0b328fef551be534d70366a75385d1f8ead3fcddec57bed85c7d4bc2d9f34546532129e63083aafa33cbb0efcbc7dc9d66e7c45f6  vte-0.28.2.tar.xz
940438fa5ca2cde3e7863484497cfb06d62edee764f801abc97fa5886a29a5a8aba6c93bba5e1a6dc21eccc8b86f5fac9cd32e1b59a4105938ae85ae0314e774  lang.patch
6872ac70f7f195d2a56aaf07a21b2f75c69eb9b023ccbfac5f90f5efd5ea74083ed441e419e3509bf5221c418ecb4d7a78866bc70dddee34b76b8acf1593b815  AltKey.patch"
