# Contributor: Aleksey Bobylev <al.bobylev@gmail.com>
# Maintainer: Aleksey Bobylev <al.bobylev@gmail.com>
pkgname="cpio"
pkgver="2.12"
pkgrel=0
pkgdesc="GNU cpio archiver"
url="https://www.gnu.org/software/cpio/"
arch="all"
license="GPL3"
makedepends="tar texinfo"
subpackages="$pkgname-doc $pkgname-lang"
source="https://ftp.igh.cnrs.fr/pub/gnu/cpio/$pkgname-$pkgver.tar.bz2"

build() {
	./configure \
		--prefix=/usr \
		--bindir=/bin \
		--sysconfdir=/etc \
		--enable-mt \
		--with-rmt=/usr/libexec/rmt # use rmt from tar package
	make
	makeinfo --html            -o doc/html      doc/cpio.texi
	makeinfo --html --no-split -o doc/cpio.html doc/cpio.texi
	makeinfo --plaintext       -o doc/cpio.txt  doc/cpio.texi
}

check() {
	make check
}

package() {
	make DESTDIR="$pkgdir" install
	rm -f "$pkgdir/usr/lib/charset.alias"

	docdir="$pkgdir/usr/share/doc/$pkgname-$pkgver"
	install -v -m755 -d               "$docdir/html"
	install -v -m644    doc/html/*    "$docdir/html"
	install -v -m644    doc/cpio.html "$docdir"
	install -v -m644    doc/cpio.txt  "$docdir"
}

sha512sums="0cd4da5f2fbca179ab4e666a5f878414c086a5f98bce4c76273f21d9b2a6fe422d901b5d453826c5f81bbe363aa015047a1e99779ad1a451c8feca6205c63120  cpio-2.12.tar.bz2"
