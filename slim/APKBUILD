# Contributor: Aleksey Bobylev <al.bobylev@gmail.com>
# Maintainer: Aleksey Bobylev <al.bobylev@gmail.com>
pkgname="slim"
pkgver="1.3.6"
pkgrel=0
pkgdesc="Desktop-independent graphical login manager for X11"
url="https://sourceforge.net/projects/slim.berlios/"
arch="all"
license="GPL-2.0"
depends="dbus slim-theme-default"
makedepends="cmake libx11-dev freetype-dev libjpeg-turbo-dev zlib-dev libpng-dev
	fontconfig-dev libxft-dev libxrender-dev libxmu-dev libxrandr-dev"
	# pam-dev libunistring consolekit2-dev
subpackages="$pkgname-doc $pkgname-theme-default:_theme:noarch"
source="https://downloads.sourceforge.net/slim.berlios/$pkgname-$pkgver.tar.gz
	no-slimlock.patch
	libslim-underlinking.patch
	slim-freetype-dirs.patch
	snprintf.patch
	musl-includes.patch
	slim-1.3.6-slitaz.patch

	slim.initd
	slim.logrotate
	slim-theme
	strings
	background.png
	panel.png
	slim.theme
	"
options="!check"

build() {
	mkdir build
	cd    build
	cmake \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_SKIP_RPATH=ON \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DUSE_CONSOLEKIT=no \
		-DX11_Xmu_LIB="/usr/lib/libXmu.so" \
		-DX11_Xft_INCLUDE_PATH=/usr/include \
		-DX11_Xmu_INCLUDE_PATH=/usr/include \
		-DUSE_PAM=no \
		..
	make
}

package() {
	cd build
	make DESTDIR="$pkgdir" install

	# remove unused systemd service
	rm -r "$pkgdir/lib/systemd"

	# Config file and rc script.
	install -Dm755 "$srcdir/slim.initd"     "$pkgdir/etc/init.d/slim"
	install -Dm644 "$srcdir/slim.logrotate" "$pkgdir/etc/logrotate.d/slim"

	# slim-theme manager & default strings
	install -Dm755 "$srcdir/slim-theme"     "$pkgdir/usr/bin/slim-theme"
	install -Dm644 "$srcdir/strings"        "$pkgdir/usr/share/slim/strings"

	# base SliTaz theme
	install -Dm644 "$srcdir/background.png" "$pkgdir/usr/share/slim/themes/base/background.png"
	install -Dm644 "$srcdir/panel.png"      "$pkgdir/usr/share/slim/themes/base/panel.png"
	install -Dm644 "$srcdir/slim.theme"     "$pkgdir/usr/share/slim/themes/base/slim.theme"
}

_theme() {
	mkdir -p "$subpkgdir/usr/share/slim/themes"
	mv "$pkgdir/usr/share/slim/themes/default" "$subpkgdir/usr/share/slim/themes"
	pkgdesc="Default theme bundled with SLiM"
}

sha512sums="345b1dee5d6f0c3716dfa7c5c16274adbf18586bdaaa6af4f310e24c5a61f79a297ffac921a5ba545523317e9fe120916df226c36b9c9b49c2ac9c1ca21dee0c  slim-1.3.6.tar.gz
3df74cf3c8b2e313b7f394a624c094ec144844003cdd264867a7bd9f46d6a10d9f5e818078340eef76cd52c38bc9ec11989f9dac2f5c693b674c2ec627f447a2  no-slimlock.patch
c66c3908147ec28b68577958bdd7bd4bc7c42b00fc4a7ce30162202a4d0ae18ef7c0c81ca60c661609e479b370ad30261494fe84bb4ffad48232536aec483729  libslim-underlinking.patch
1f957eadb586b8f0523a2cf6ea550280a542500de925383a06d658424c524a4ef5b148aa9150a9f045529c896fe69c013417b9883583acc12a7a656b7202eded  slim-freetype-dirs.patch
22fcbdc54b1a5dc0d3501649addb8e290c63ea4a6f9d0bdbdbe9bdea1c9df785f6763f2cee2ff33e6ca2dd49c1c65fd9d036fd9527f298a7ca9e0c5acc48e854  snprintf.patch
bf1f44814dcf220b91eef8cd766c7eb3b2c2667a211d1206f3e57b88e5e7fbe17ea1e7b3c7c231cb52356b6c7df650af94759b1c154a8dd7d95dc45a9aec0e86  musl-includes.patch
e34ded65ffde2712a13637f87031cbd757d253382dec18bf6542fed950b527c375faac5cc1455440635c677e247da7fbece25fbee54f4a981dc43b52b65887f8  slim-1.3.6-slitaz.patch
bf6a6a45acea3d552aa80d7f4f25c300d4ce221f1e52b8bf6a9352d1cdd9bde07edb121fc524a50758cba299fd481f3d01a81c1d10c26f0f8346d7525d198049  slim.initd
e5f398ea58adbedea7ae40c7a907d2f926148ee6f3c51fc5761b84d1d119c091fa0cf34f908cd49300fcddea71c5c9b6f2ac21731808ce5d73ea65a65b19a55b  slim.logrotate
b5c31f3bef16547ccfcc3e03312b456a01b7de4f9e9f7590e09c62a6b748c492161bdd497f0240e38e76b83ad89e674fff95fe67bea5e04e2ddbe046e57e17eb  slim-theme
b46d7cbdc70e6b708129e35491072bb48750d64626d6e0a542b439aa5de58a803d1be5257aff0af52f55450a8e5e2203833f26957d572e24b35564373e9c494f  strings
830584a5065101ef840a8fb5db2af6d74227148ebcf305ea3de958c5ce435182c77ba71eb0c1198fbc18328dd4bdac66ab6767530b6bc4998231c2c7826a677e  background.png
7539a8a06d2dd38facfde1d73a031ad11c854887d0fbaef7ba6b3e21c605846ee6e97fde91ec36b0b33a910425408c56e9e9d39fc00cb01e233aee17e6a9e6db  panel.png
731e62a23118538ec23a37204acda97e258ba41ef3854351139d8b020d536a33554bbaf01ce01b31a317c942044c57e9c1a6eef27219e60a3e2e44d8b9024d94  slim.theme"
