# Contributor: Aleksey Bobylev <al.bobylev@gmail.com>
# Maintainer: Aleksey Bobylev <al.bobylev@gmail.com>
pkgname="py3-setuptools"
_pkgname=${pkgname#py3-}
pkgver="41.0.0"
pkgrel=0
pkgdesc="A collection of enhancements to the Python3 distutils"
url="https://pypi.python.org/pypi/setuptools"
arch="noarch"
license="MIT"
depends="python3"
makedepends="python3-dev python2-dev"
subpackages="py2-$_pkgname:_py2"
source="$_pkgname-$pkgver.tar.gz::https://github.com/pypa/$_pkgname/archive/v$pkgver.tar.gz"
builddir="$srcdir/$_pkgname-$pkgver"
options="!check" #no testsuite

replaces="python3"
install_if="$pkgname=$pkgver-r$pkgrel python3"

prepare() {
	python3 bootstrap.py
	python2 bootstrap.py
}

build() {
	python3 setup.py build
	python2 setup.py build
}

package() {
	python3 -B setup.py install --prefix=/usr --root="$pkgdir"
	# we don't provide a non-suffixed easy_install
	rm -f "$pkgdir/usr/bin/easy_install"
	# clean Windows™ binaries: cli{,-32,-64}.exe, gui{,-32,-64}.exe
	find "$pkgdir" -type f -name '*.exe' -delete
}

_py2() {
	replaces="python2"
	install_if="$pkgname=$pkgver-r$pkgrel python2"
	pkgdesc="${pkgdesc/3/2}"
	depends="python2"

	cd "$builddir"
	python2 -B setup.py install --prefix=/usr --root="$subpkgdir"
	# we don't provide a non-suffixed easy_install
	rm -f "$subpkgdir/usr/bin/easy_install"
	# clean Windows™ binaries: cli{,-32,-64}.exe, gui{,-32,-64}.exe
	find "$subpkgdir" -type f -name '*.exe' -delete
}

sha512sums="cdb4fd37df907594838cc16899060b9a8e052c209557df735770d2514bad2d7e2646452f01431d89d01f853a9e5acf55db60b0cb58f6acf396d48a58489834c9  setuptools-41.0.0.tar.gz"
